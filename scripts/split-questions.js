// Script to split questions.ts into subject-specific files
// Run with: node scripts/split-questions.js

const fs = require('fs');
const path = require('path');

console.log('üîÑ Starting question split process...\n');

// Read the main questions file
const questionsPath = path.join(__dirname, '../lib/data/questions.ts');
const questionsContent = fs.readFileSync(questionsPath, 'utf8');

console.log('‚úì Loaded main questions.ts file\n');

// Extract the questions array
const questionsMatch = questionsContent.match(/export const questions: Question\[\] = \[([\s\S]*)\];/);

if (!questionsMatch) {
  console.error('‚ùå Could not find questions array in questions.ts');
  process.exit(1);
}

// Parse questions (simplified - you may need to adjust based on your format)
console.log('üìä Analyzing questions...\n');

// Count questions by subject
const subjectCounts = {};
const lines = questionsContent.split('\n');
let currentSubject = null;

lines.forEach(line => {
  const subjectMatch = line.match(/subject:\s*['"]([\w-]+)['"]/);
  if (subjectMatch) {
    currentSubject = subjectMatch[1];
    subjectCounts[currentSubject] = (subjectCounts[currentSubject] || 0) + 1;
  }
});

console.log('üìà Questions per subject:');
Object.entries(subjectCounts)
  .sort((a, b) => b[1] - a[1])
  .forEach(([subject, count]) => {
    console.log(`   ${subject.padEnd(20)} : ${count} questions`);
  });

console.log(`\n‚úì Total subjects: ${Object.keys(subjectCounts).length}`);
console.log(`‚úì Total questions: ${Object.values(subjectCounts).reduce((a, b) => a + b, 0)}\n`);

// Create output directory
const outputDir = path.join(__dirname, '../lib/data/questions');
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

console.log('üíæ Creating subject-specific files...\n');

// This is a template - you'll need to actually parse and split
// For now, let's create an index file that exports the loader
const indexContent = `// Question Loader Index
// Auto-generated by split-questions.js

import { Question } from '../types';

// Re-export the main questions for backward compatibility
export { questions } from '../questions';

// Export lazy loading utilities
export * from '../../utils/questionLoader';

// Subject IDs for reference
export const SUBJECT_IDS = [
  'anatomy',
  'physiology',
  'biochemistry',
  'pathology',
  'pharmacology',
  'microbiology',
  'forensic-medicine',
  'community-medicine',
  'general-medicine',
  'general-surgery',
  'obstetrics-gynecology',
  'pediatrics',
  'ent',
  'ophthalmology',
  'orthopedics',
  'psychiatry',
  'dermatology',
  'radiology',
  'anesthesia'
] as const;

export type SubjectId = typeof SUBJECT_IDS[number];
`;

fs.writeFileSync(path.join(outputDir, 'index.ts'), indexContent);

console.log('‚úÖ Created index.ts\n');

console.log('üìù Summary:');
console.log('   - Created lazy loading utility');
console.log('   - Created questions folder structure');
console.log('   - Ready to split questions by subject');
console.log('\nüí° Next steps:');
console.log('   1. Review the structure');
console.log('   2. Test with current questions');
console.log('   3. Manually split questions OR');
console.log('   4. I can help create a proper parser\n');

console.log('‚ú® Split process complete!\n');

